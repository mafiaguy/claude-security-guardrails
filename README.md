# Security Guardrails for Claude Code

A real-time security guardrails system that automatically scans code generated by Claude Code for vulnerabilities, secrets, and insecure patterns â€” and **blocks dangerous actions before they execute**.

Built with Claude Code hooks, a Node.js scanning engine, and a React dashboard.

![Dashboard Overview](assets/dashboard-overview.png)

---

## Table of Contents

- [What It Does](#what-it-does)
- [Screenshots](#screenshots)
- [Quick Start](#quick-start)
- [Running with Docker](#running-with-docker)
- [Commands Reference](#commands-reference)
- [Using Personally](#using-personally)
- [Using in Your Organisation](#using-in-your-organisation)
- [How Hooks Work](#how-hooks-work)
- [What Gets Detected](#what-gets-detected)
- [Safety Levels](#safety-levels)
- [API Endpoints](#api-endpoints)
- [Project Structure](#project-structure)
- [Logging](#logging)
- [License](#license)

---

## What It Does

### 1. Blocks Dangerous Code Before It's Written

When Claude Code tries to write a file containing secrets, SQL injection, eval(), or other vulnerabilities â€” the **PreToolUse hook blocks the write** and tells Claude to fix it:

![Hook Blocking](assets/hook-blocking.png)

### 2. Blocks Dangerous Shell Commands

When Claude Code tries to run `rm -rf /`, `git push --force main`, `cat .env`, `DROP DATABASE`, or other destructive commands â€” they get **denied before execution**:

```
ğŸš¨ [rm-root] Dangerous command blocked: rm targeting root filesystem
   Command: rm -rf /

â›” [git-force-main] Dangerous command blocked: Force push to main/master
   Command: git push --force origin main

â›” [cat-env] Dangerous command blocked: Reading .env file â€” may expose secrets
   Command: cat .env
```

### 3. Scans Code for Vulnerabilities

Run manual scans on any codebase to find secrets, OWASP vulnerabilities, insecure dependencies, and dangerous code patterns:

![CLI Scan Output](assets/cli-scan-output.png)

### 4. Real-Time Dashboard

Monitor everything in a live dashboard â€” security score, severity breakdown, category distribution, hook activity log, and detailed findings:

![Full Dashboard](assets/dashboard-full.png)

---

## Screenshots

### Dashboard â€” Score, Charts & Activity Log
![Dashboard Score & Charts](assets/dashboard-overview.png)

*Security score gauge (0-100), severity bar chart, category donut chart, and hook activity log showing blocked events with timestamps, tools, and reasons.*

### CLI â€” Scan Report
![CLI Output](assets/cli-scan-output.png)

*Terminal output showing scan results with color-coded severity, file locations, descriptions, and code snippets.*

### Hooks â€” Blocking Dangerous Actions
![Hook Blocking](assets/hook-blocking.png)

*PreToolUse hook blocking dangerous Bash commands (rm -rf, force push, curl|bash, cat .env) and malicious code writes (AWS keys, hardcoded passwords).*

---

## Quick Start

### Prerequisites

- **Node.js** >= 18
- **npm** >= 9
- **Claude Code** CLI installed ([install guide](https://docs.anthropic.com/en/docs/claude-code))
- **Docker** (optional)

### Install

```bash
# Clone the repo
git clone https://github.com/yourusername/claude-security-guardrails.git
cd claude-security-guardrails

# Install dependencies
npm install
```

### Set Up Hooks

```bash
npm run setup-hooks
```

Output:
```
+ PreToolUse hook installed (BLOCKS writes with critical/high issues)
+ PostToolUse hook installed (reports findings + saves to dashboard)

â”€â”€ How it works â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  PreToolUse  â†’ Runs BEFORE Write/Edit/Bash
                ğŸš« BLOCKS dangerous commands (rm -rf, force push, etc.)
                ğŸš« BLOCKS code with secrets/vulnerabilities
  PostToolUse â†’ Runs AFTER Write/Edit
                ğŸ“Š Scans file, saves results to dashboard
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

### Run a Test Scan

```bash
npm run scan -- ./test-fixtures/
```

### Start the Dashboard

```bash
npm run dev
```

Open **http://localhost:5173** in your browser.

That's it. Hooks are active, the scanner is ready, and the dashboard is live.

---

## Running with Docker

No database required. Single container serves both the API and dashboard.

### Docker Compose (Recommended)

```bash
# Build and start
docker compose up -d

# View logs
docker compose logs -f

# Stop
docker compose down
```

### Docker Manual

```bash
# Build
docker build -t claude-security-guardrails .

# Run
docker run -d -p 3001:3001 --name security-guardrails claude-security-guardrails
```

Open **http://localhost:3001** â€” both the API and the dashboard are served from the same port.

### Persistent Data

Docker Compose uses a named volume `scan-data` to persist scan results and activity logs across container restarts.

---

## Commands Reference

| Command | Description |
|---------|-------------|
| `npm install` | Install all dependencies |
| `npm run setup-hooks` | Install Claude Code hooks (one-time) |
| `npm run scan -- <path>` | Scan a file or directory |
| `npm run scan -- <path> --json` | Scan with JSON output |
| `npm run scan -- <path> --dry-run` | Scan without saving results |
| `npm run scan:results` | Show latest scan results as JSON |
| `npm run server` | Start API server only (port 3001) |
| `npm run dashboard` | Start dashboard only (port 5173) |
| `npm run dev` | Start both API + dashboard |
| `docker compose up -d` | Run everything in Docker |
| `docker compose down` | Stop Docker |

---

## Using Personally

You can use this on your own machine for all your Claude Code projects. Here's how:

### Option A: Per-Project (Current Setup)

The default setup. Hooks only activate when Claude Code is working inside this project directory.

```bash
cd claude-security-guardrails
npm run setup-hooks    # hooks written to .claude/settings.json in this project
```

**Pros:** No impact on other projects, easy to customize per-project.
**Cons:** Only protects this one project.

### Option B: Global â€” Protect All Projects

Install hooks globally so they activate in **every project** you use Claude Code in.

**Step 1:** Copy hook scripts to a permanent location:

```bash
mkdir -p ~/.claude/hooks
cp hooks/pre-tool-use.js ~/.claude/hooks/
cp hooks/post-tool-use.js ~/.claude/hooks/

# Also copy the scanner (hooks depend on it)
cp -r scanner/ ~/.claude/hooks/scanner/
```

**Step 2:** Edit `~/.claude/settings.json` (global config):

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Write|Edit|Bash",
        "hooks": [{
          "type": "command",
          "command": "node ~/.claude/hooks/pre-tool-use.js"
        }]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [{
          "type": "command",
          "command": "node ~/.claude/hooks/post-tool-use.js"
        }]
      }
    ]
  }
}
```

**Step 3:** Update the `require()` paths inside the copied hook scripts to point to the new scanner location (`~/.claude/hooks/scanner/...`).

Now every Claude Code session on your machine is protected â€” regardless of which project you're in.

### Option C: Dashboard Always Running

Keep the dashboard running as a background service to monitor all Claude Code activity:

```bash
# Add to your shell profile (.zshrc / .bashrc)
alias security-dashboard="cd ~/claude-security-guardrails && npm run dev"
```

Or use Docker:

```bash
docker run -d --restart unless-stopped -p 3001:3001 --name security-guardrails claude-security-guardrails
```

The dashboard is always at http://localhost:3001.

---

## Using in Your Organisation

### The Problem

When teams use Claude Code, AI-generated code can introduce:
- Hardcoded secrets (API keys, passwords, connection strings)
- OWASP vulnerabilities (SQL injection, XSS, command injection)
- Dangerous commands (`rm -rf`, force push to main, `DROP DATABASE`)
- Insecure dependencies and code patterns

You want guardrails that protect **every developer** automatically, without relying on individual discipline.

### Option 1: Ship Hooks in Every Repo (Recommended for Teams)

Add the `.claude/` directory and hooks to your organisation's repos. When any developer clones the repo and uses Claude Code, hooks activate automatically.

**What to add to each repo:**

```
your-org-repo/
â”œâ”€â”€ .claude/
â”‚   â””â”€â”€ settings.json          â† hooks auto-activate
â”œâ”€â”€ .claude-hooks/
â”‚   â”œâ”€â”€ pre-tool-use.js        â† blocking hook
â”‚   â”œâ”€â”€ post-tool-use.js       â† reporting hook
â”‚   â””â”€â”€ scanner/               â† scanning engine
â”‚       â”œâ”€â”€ scanners/
â”‚       â”‚   â”œâ”€â”€ secrets.js
â”‚       â”‚   â”œâ”€â”€ owasp.js
â”‚       â”‚   â”œâ”€â”€ codePatterns.js
â”‚       â”‚   â””â”€â”€ dangerousCommands.js
â”‚       â””â”€â”€ utils/
â”‚           â”œâ”€â”€ severity.js
â”‚           â””â”€â”€ activityLog.js
â””â”€â”€ src/
    â””â”€â”€ ...
```

**`.claude/settings.json`:**
```json
{
  "hooks": {
    "PreToolUse": [{
      "matcher": "Write|Edit|Bash",
      "hooks": [{
        "type": "command",
        "command": "node .claude-hooks/pre-tool-use.js"
      }]
    }],
    "PostToolUse": [{
      "matcher": "Write|Edit",
      "hooks": [{
        "type": "command",
        "command": "node .claude-hooks/post-tool-use.js"
      }]
    }]
  }
}
```

**Pros:** Zero setup for developers, version-controlled, customizable per-repo.
**Cons:** Need to add to each repo (automate with a template or CI step).

### Option 2: Claude Code Enterprise Managed Settings

For Claude Code on an enterprise plan, admins can enforce hooks via managed settings that developers cannot override.

**Via environment variable** (set in MDM profiles, login scripts, or CI):

```bash
export CLAUDE_SETTINGS_OVERRIDES='{
  "hooks": {
    "PreToolUse": [{
      "matcher": "Write|Edit|Bash",
      "hooks": [{
        "type": "command",
        "command": "node /opt/company/claude-hooks/pre-tool-use.js"
      }]
    }]
  }
}'
```

**Via managed policy file** (distributed via MDM/Chef/Puppet/Ansible):

Place at a system-level path that Claude Code reads on startup. This ensures hooks are enforced even if a developer modifies their local settings.

**Pros:** Enforced org-wide, developers can't disable it, centrally managed.
**Cons:** Requires enterprise plan, MDM/deployment infrastructure.

### Option 3: Centralised Dashboard for Org-Wide Visibility

Run the dashboard as a shared service that all developer hooks report to:

**Step 1:** Deploy the dashboard on an internal server:

```bash
# On your internal server / Kubernetes / ECS
docker compose up -d
```

**Step 2:** Configure developer hooks to POST activity to the central server:

Update `activityLog.js` to send events to a central API in addition to (or instead of) local file storage. This gives you:

- Org-wide view of what Claude Code is doing across all developers
- Central log of all blocked commands and code writes
- Aggregated security metrics for compliance reporting

**Step 3:** Set up alerts (Slack, PagerDuty, email) for critical blocked events.

### Option 4: Git Hooks + CI/CD Integration

In addition to Claude Code hooks, add the scanner to your CI/CD pipeline:

```yaml
# .github/workflows/security-scan.yml
name: Security Scan
on: [push, pull_request]
jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - run: npm install
      - run: npm run scan -- . --json > scan-results.json
      - name: Check for critical issues
        run: |
          CRITICALS=$(node -e "const r=require('./scan-results.json'); console.log(r.severityCounts.critical)")
          if [ "$CRITICALS" -gt 0 ]; then
            echo "::error::Found $CRITICALS critical security issues"
            exit 1
          fi
```

This gives you a safety net even if someone bypasses local hooks.

### Recommended Org Setup

| Layer | What | How |
|-------|------|-----|
| **Developer machine** | Block dangerous actions in real-time | Hooks via per-repo `.claude/settings.json` or enterprise managed settings |
| **Central dashboard** | Org-wide visibility + monitoring | Docker on internal server |
| **CI/CD** | Safety net for anything that slips through | GitHub Actions / GitLab CI running the scanner |
| **Alerts** | Immediate notification on critical events | Slack/PagerDuty integration on the dashboard |

---

## How Hooks Work

### Architecture

```
Claude Code tries to write code or run a command
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PreToolUse Hook                    â”‚
â”‚  âœ“ Write/Edit â†’ Scan for secrets,  â”‚
â”‚    vulnerabilities, insecure code   â”‚
â”‚  âœ“ Bash â†’ Check for dangerous      â”‚
â”‚    commands (rm -rf, force push)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    BLOCKED       ALLOWED
   (denied)     (executed)
                    â”‚
                    â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  PostToolUse Hook  â”‚
          â”‚  Full scan + save  â”‚
          â”‚  results to        â”‚
          â”‚  dashboard         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Protocol

Hook scripts communicate with Claude Code via **stdin/stdout JSON**:

```
Claude Code â†’ pipes JSON to hook's stdin:
  { "tool_name": "Bash", "tool_input": { "command": "rm -rf /" } }

Hook â†’ writes JSON to stdout:

  Allow:  {}
  Block:  { "hookSpecificOutput": {
              "hookEventName": "PreToolUse",
              "permissionDecision": "deny",
              "permissionDecisionReason": "ğŸš¨ rm targeting root filesystem"
            }}
```

### Scope

| Settings location | Scope |
|-------------------|-------|
| `.claude/settings.json` (in project) | This project only |
| `~/.claude/settings.json` (home dir) | All projects for this user |
| `CLAUDE_SETTINGS_OVERRIDES` env var | Enforced, cannot be overridden |

---

## What Gets Detected

### Secrets (10 patterns)

| Pattern | Severity |
|---------|----------|
| AWS Access Keys (`AKIA...`) | Critical |
| AWS Secret Keys | Critical |
| GitHub Tokens (`ghp_`, `gho_`, etc.) | Critical |
| Private Keys (`-----BEGIN RSA PRIVATE KEY-----`) | Critical |
| Database Connection Strings (`mongodb://`, `postgres://`) | Critical |
| Slack Tokens (`xoxb-...`) | Critical |
| API Keys | High |
| JWT Tokens (`eyJ...`) | High |
| Hardcoded Passwords | High |
| Generic Secrets/Tokens | Medium |

### OWASP Top 10 (13 patterns)

| Pattern | Severity |
|---------|----------|
| SQL Injection (string concat in queries) | Critical |
| Command Injection (`exec()` with user input) | Critical |
| XSS (`innerHTML`, `dangerouslySetInnerHTML`, `document.write`) | High |
| SSRF (fetch/axios with user-controlled URLs) | High |
| Path Traversal (file ops with user input) | High/Medium |
| CORS Misconfiguration (`origin: '*'`) | Medium |

### Dangerous Commands (30+ patterns)

| Category | Examples | Severity |
|----------|----------|----------|
| Filesystem destruction | `rm -rf /`, `rm -rf ~/`, `rm -rf .` | Critical |
| Disk wipe | `dd of=/dev/sda`, `mkfs` | Critical |
| Fork bombs | `:(){ :\|:& };:` | Critical |
| Git disasters | `git push --force main`, `git reset --hard`, `git clean -f` | High |
| Remote code execution | `curl \| bash`, `wget \| sh` | High |
| Secrets exposure | `cat .env`, `printenv`, `echo $SECRET_KEY` | High |
| Database destruction | `DROP DATABASE`, `TRUNCATE TABLE` | High |
| System commands | `shutdown`, `reboot`, `killall`, `chmod 777` | High |
| Data exfiltration | `curl -d @.env`, `scp .env`, `rsync secrets` | High |

### Dependencies (16 known vulnerable packages)

Checks `package.json` for outdated packages with known CVEs (lodash, jsonwebtoken, shell-quote, axios, minimist, etc.) and flags wildcard/broad version ranges.

### Code Patterns (11 patterns)

| Pattern | Severity |
|---------|----------|
| `eval()` usage | Critical |
| `new Function()` constructor | High |
| MD5 hashing for passwords | High |
| Disabled TLS (`rejectUnauthorized: false`) | High |
| `Math.random()` for security purposes | Medium |
| Sensitive data in `console.log()` | Medium |
| Hardcoded IPs and ports | Low |

---

## Safety Levels

The PreToolUse hook has a configurable safety level in `hooks/pre-tool-use.js`:

```js
const SAFETY_LEVEL = 'high'; // 'critical' | 'high' | 'strict'
```

| Level | What gets blocked |
|-------|------------------|
| `critical` | Only catastrophic: leaked secrets, eval(), rm -rf /, fork bombs |
| **`high`** (default) | + risky: XSS, SQL injection, force push main, git reset --hard, weak crypto |
| `strict` | + cautionary: all medium/low findings, any force push, sudo rm, docker prune |

---

## API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/results` | GET | All scan results (array) |
| `/api/results/latest` | GET | Most recent scan result |
| `/api/summary` | GET | Aggregated summary (score, counts) |
| `/api/activity` | GET | Recent hook events (blocked/allowed/findings) |
| `/api/activity/stats` | GET | Blocked/allowed/warning counts |
| `/api/health` | GET | Health check |

---

## Project Structure

```
claude-security-guardrails/
â”œâ”€â”€ package.json                    # Root workspace config
â”œâ”€â”€ Dockerfile                      # Multi-stage Docker build
â”œâ”€â”€ docker-compose.yml              # Docker Compose config
â”œâ”€â”€ README.md                       # This file
â”œâ”€â”€ assets/                         # Screenshots
â”‚   â”œâ”€â”€ dashboard-overview.png
â”‚   â”œâ”€â”€ dashboard-full.png
â”‚   â”œâ”€â”€ dashboard-score-charts.png
â”‚   â”œâ”€â”€ cli-scan-output.png
â”‚   â””â”€â”€ hook-blocking.png
â”œâ”€â”€ scanner/                        # Scanning engine
â”‚   â”œâ”€â”€ index.js                    # Orchestrator
â”‚   â”œâ”€â”€ cli.js                      # CLI interface
â”‚   â”œâ”€â”€ server.js                   # Express API server
â”‚   â”œâ”€â”€ scanners/
â”‚   â”‚   â”œâ”€â”€ secrets.js              # 10 secret patterns
â”‚   â”‚   â”œâ”€â”€ owasp.js                # 13 OWASP patterns
â”‚   â”‚   â”œâ”€â”€ dependencies.js         # 16 vulnerable packages
â”‚   â”‚   â”œâ”€â”€ codePatterns.js         # 11 code patterns
â”‚   â”‚   â””â”€â”€ dangerousCommands.js    # 30+ dangerous commands
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ fileUtils.js
â”‚   â”‚   â”œâ”€â”€ severity.js
â”‚   â”‚   â”œâ”€â”€ store.js
â”‚   â”‚   â””â”€â”€ activityLog.js
â”‚   â””â”€â”€ data/                       # Auto-created
â”‚       â”œâ”€â”€ scan-results.json
â”‚       â””â”€â”€ activity-log.json
â”œâ”€â”€ hooks/                          # Claude Code hooks
â”‚   â”œâ”€â”€ pre-tool-use.js             # BLOCKING hook
â”‚   â”œâ”€â”€ post-tool-use.js            # Reporting hook
â”‚   â””â”€â”€ setup-hooks.js              # Installer
â”œâ”€â”€ dashboard/                      # React + Vite
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ components/
â”‚           â”œâ”€â”€ SecurityScore.jsx
â”‚           â”œâ”€â”€ SeverityChart.jsx
â”‚           â”œâ”€â”€ CategoryBreakdown.jsx
â”‚           â”œâ”€â”€ ActivityLog.jsx
â”‚           â”œâ”€â”€ RecentScans.jsx
â”‚           â”œâ”€â”€ FindingsTable.jsx
â”‚           â””â”€â”€ Header.jsx
â”œâ”€â”€ test-fixtures/                  # Sample vulnerable files
â””â”€â”€ .claude/
    â””â”€â”€ settings.json               # Hook configuration
```

---

## Logging

All hook activity is logged in two places:

**1. File logs** (per developer):
```
~/.claude/hooks-logs/2026-02-19.jsonl
```

**2. Dashboard logs** (visible in UI):
```
scanner/data/activity-log.json
```

Example log entry:
```json
{
  "id": "evt_1771501445272_wvx6",
  "timestamp": "2026-02-19T11:44:05.272Z",
  "action": "blocked",
  "hook": "PreToolUse",
  "tool": "Bash",
  "target": "rm -rf /",
  "reason": "rm targeting root filesystem",
  "severity": "critical",
  "patternId": "rm-root"
}
```

---

## License

MIT
